// mobile-app/lib/features/chat/chat_screen.dart
StreamBuilder(
  stream: FirebaseFirestore.instance
      .collection('chats')
      .doc(chatId)
      .collection('messages')
      .orderBy('timestamp', descending: true)
      .snapshots(),
  builder: (context, snapshot) {
    if (!snapshot.hasData) return Center(child: CircularProgressIndicator());
    
    var messages = snapshot.data!.docs;
    return ListView.builder(
      reverse: true,
      itemCount: messages.length,
      itemBuilder: (context, index) {
        bool isMe = messages[index]['senderId'] == currentUserId;
        return Align(
          alignment: isMe ? Alignment.centerRight : Alignment.centerLeft,
          child: Container(
            margin: EdgeInsets.all(8),
            padding: EdgeInsets.symmetric(horizontal: 16, vertical: 10),
            decoration: BoxDecoration(
              color: isMe ? Color(0xFFD4AF37) : Colors.grey[200],
              borderRadius: BorderRadius.circular(20),
            ),
            child: Text(messages[index]['text']),
          ),
        );
      },
    );
  },
)
