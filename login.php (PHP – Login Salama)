<?php
include "db.php";

$error = "";

if($_SERVER["REQUEST_METHOD"]=="POST"){
  $email = $_POST["email"];
  $pass  = $_POST["password"];

  $stmt = $conn->prepare("SELECT id,password,role FROM users WHERE email=?");
  $stmt->bind_param("s",$email);
  $stmt->execute();
  $res = $stmt->get_result();

  if($res->num_rows === 1){
    $user = $res->fetch_assoc();
    if(password_verify($pass,$user["password"])){
      $_SESSION["user_id"] = $user["id"];
      $_SESSION["role"] = $user["role"];
      header("Location: index.php");
      exit;
    }
  }
  $error = "Email au password si sahihi";
}
?>
