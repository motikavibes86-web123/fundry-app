<?php
include "db.php";

$search = $_GET['search'] ?? '';
$page = isset($_GET['page']) ? (int)$_GET['page'] : 1;
$limit = 30;
$offset = ($page-1)*$limit;

$sql = "SELECT * FROM books WHERE title LIKE ? OR description LIKE ? ORDER BY id ASC LIMIT ?,?";
$stmt = $conn->prepare($sql);
$like = "%$search%";
$stmt->bind_param("ssii",$like,$like,$offset,$limit);
$stmt->execute();
$result = $stmt->get_result();

?>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Motika Vibes - Books</title>
<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
<h1>Motika Vibes - Vitabu</h1>

<form method="GET">
<input type="text" name="search" placeholder="Tafuta vitabu..." value="<?php echo htmlspecialchars($search); ?>">
<button type="submit">Tafuta</button>
</form>

<div class="row">
<?php while($book = $result->fetch_assoc()): ?>
<div class="col-md-4 mt-3">
    <div class="card">
        <img src="<?php echo $book['image']; ?>" class="card-img-top" alt="<?php echo $book['title']; ?>">
        <div class="card-body">
            <h5 class="card-title"><?php echo $book['title']; ?></h5>
            <p class="card-text"><?php echo $book['description']; ?></p>
            <p><b>Tsh <?php echo number_format($book['price']); ?></b></p>
            <a href="purchase.php?book_id=<?php echo $book['id']; ?>" class="btn btn-primary">Nunua Kitabu</a>
        </div>
    </div>
</div>
<?php endwhile; ?>
</div>

</div>
</body>
</html>
